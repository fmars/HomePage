<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 5.5.1 (402628)"/><meta name="altitude" content="-0.87508893013"/><meta name="author" content="fmarsf@gmail.com"/><meta name="created" content="2015-04-23 20:11:08 +0000"/><meta name="latitude" content="37.48472777978338"/><meta name="longitude" content="-122.1474251967533"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2015-04-24 08:33:04 +0000"/><title>04.23.2015</title></head><body>
<div>08:30 getup</div>
<div>struggle</div>
<div>13:00 start to send out team asking again</div>
<div><br/></div>
<div><br/></div>
<div>tupperware/agent:LogReaderTest - LogReaderTest.testFileTimeout...failed (7s)</div>
<div>I0423 13:21:39.234599 1746550 LogReaderTest.cpp:132] Using test log dir /tmp/log-reader-test.n4sIeb</div>
<div>I0423 13:21:39.237009 1746550 LogReaderTest.cpp:111] currentYear: 2014</div>
<div>I0423 13:21:39.237089 1746550 LogReaderTest.cpp:111] currentYear: 2014</div>
<div>I0423 13:21:39.237392 1746550 LogReaderTest.cpp:111] currentYear: 2014</div>
<div>I0423 13:21:39.237483 1746550 LogReaderTest.cpp:147] Using tmp dir /tmp/TaskTest.hI9GIU</div>
<div>I0423 13:21:39.259373 1746550 DirectoryManager.cpp:1941] Successfully updated system files config.</div>
<div>I0423 13:21:39.263556 1746550 DirectoryManager.cpp:1961] Successfully updated chroot setup config.</div>
<div>I0423 13:21:39.902024 1746550 HashStore.cpp:71] Opened a connection to the rocksdb at /tmp/TaskTest.hI9GIU/ChrootInfo.hdb</div>
<div>E0423 13:21:39.902215 1746550 HashStore-inl.h:26] Failed to read value for key: __CHROOTS__</div>
<div>E0423 13:21:39.902226 1746550 HashStore-inl.h:26] Failed to read value for key: __DIR__</div>
<div>I0423 13:21:39.902377 1746550 DirectoryManager.cpp:200] Initialized with 528 system files.</div>
<div>I0423 13:21:39.902542 1746550 LogReaderTest.cpp:111] currentYear: 2014</div>
<div>I0423 13:21:46.476894 1746563 FileManager-inl.h:148] Starting grep --line-number -i LargeFileTest</div>
<div>tupperware/agent/LogReaderTest.cpp:662: Failure</div>
<div>Expected: this-&gt;handler_-&gt;searchLog(response, grepLog) throws an exception of type AgentException.</div>
<div>Actual: it throws nothing.</div>
<div>I0423 13:21:46.478883 1746563 FileManager-inl.h:184] Finished grep --line-number -i LargeFileTest</div>
<div>E0423 13:21:46.478909 1746563 FileManager-inl.h:187] grep exit status: 1</div>
<div>tupperware/allocator:AllocatorTest - AllocatorTest.RackReservationsShadowAllocation...ok (3s)</div>
<div><br/></div>
<div><br/></div>
<div><br/></div>
<div><br/></div>
<div><br/></div>
<div>tupperware/scheduler:message_queue_test - MessageQueueTest.publish...failed (1s)</div>
<div>E0423 13:22:08.892055 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:08.898701 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:08.927841 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:08.937011 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.083430 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.140097 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.148066 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.174269 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.185345 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.187914 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.210144 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.226831 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.259953 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.291990 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.296448 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.327595 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.338201 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.351657 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.354931 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.355124 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.374796 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.382457 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.394497 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.400992 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.422345 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.423961 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.434319 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.434551 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.435164 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.435542 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.435753 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.436067 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.436167 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>E0423 13:22:09.451525 1752789 MessageQueue.cpp:303] blocking publish failed: exchange full</div>
<div>W0423 13:22:09.985760 1752813 MessageQueue.cpp:136] TestSub queue is full</div>
<div>tupperware/scheduler/MessageQueueTest.cpp:212: Failure</div>
<div>Value of: 200000</div>
<div>Expected: t_.mcount_</div>
<div>Which is: 149636</div>
<div><br/></div>
<div>Currently the bindAndSubstituteArgs which reserve and bind ports happens in both DirectoryManager and ProcessExecutor. And already fixed race condition in ProcessExecutor. However they are doing the same thing and cannot remove bindAndSubstituteArgs from DirectoryManager because it is related to another part of the system. </div>
<div>So I moved all the port state from ProcessExecutor into DirectoryManager to fix the race condition.</div>
<div>Reserve ports in bindAndSubstituteArgs and map reserved port with a task handle which is global unique. Free the reserved ports in freeChroot.</div>
<div><br/></div>
<div><br/></div>
<div>-14:00 sent another diff for 'don't double reserve ports'</div>
<div>14:00 continue tw-online-processor-count </div>
<div>     failed again</div>
<div><br/></div>
<div><br/></div>
<div>22:00 try to find out why cannot symlink or mount</div>
<div>file not exist?? wrong</div>
<div>no sudo permission</div>
<div>          mount</div>
<div>          uid (setuid flag s) (uid and euid) (chown, chmod)</div>
<div>          it's not we don't have permission to make symlink in /sys. Actually I think sys is empty or some other specific state at that time.</div>
<div><br/></div>
<div><br/></div>
<div>I0424 00:50:03.137642 3038891 SystemUtil.cpp:1078 (117-0)] Command: /usr/facebook/tupperware/bin/timeout.s│ 812 string chrootPath = pathJoin(newRoot, "/dev/testOnline");</div>
<div>h 300s /usr/facebook/tupperware/bin/tw-mount /proc /var/facebook/tupperware/agent/data/fjc/put-symlink-ahe│ 813 if (!system_-&gt;bindMount(hostPath, chrootPath)) {</div>
<div>ad-7/0/20150424.005003.87887.2401:db00:0020:a014:face:0000:0018:0000.3038654/proc \'\' 528384 \'\'; return│ 814 LOG(ERROR) &lt;&lt; "Failed to mount " &lt;&lt; hostPath &lt;&lt; " to " &lt;&lt; chrootPath;</div>
<div>ed with rc: exited with status 0; after 0.00542092 ms │ 815 LOG(ERROR) &lt;&lt; "Curent uid "&lt;&lt;getuid() &lt;&lt;" curent euid"&lt;&lt;geteuid();</div>
<div>About to run command with timeout of 300s: /usr/facebook/tupperware/bin/tw-mount /sys /var/facebook/tupper│ 816 //return false;</div>
<div>ware/agent/data/fjc/put-symlink-ahead-7/0/20150424.005003.87887.2401:db00:0020:a014:face:0000:0018:0000.30│ 817 }</div>
<div>38654/sys '' 528384 '' │ 818 if (!system_-&gt;createDirs(pathJoin(newRoot,</div>
<div>I0424 00:50:03.143419 3038891 SystemUtil.cpp:1078 (117-0)] Command: /usr/facebook/tupperware/bin/timeout.s│ 819 "/sys/devices/system/cpu/fmars").c_str(), 0755)){</div>
<div>h 300s /usr/facebook/tupperware/bin/tw-mount /sys /var/facebook/tupperware/agent/data/fjc/put-symlink-ahea│ 820 LOG(ERROR) &lt;&lt; "FMARS FAILED TO CREATE DIR IN SYS";</div>
<div>d-7/0/20150424.005003.87887.2401:db00:0020:a014:face:0000:0018:0000.3038654/sys \'\' 528384 \'\'; returned│ 821 }</div>
<div>with rc: exited with status 0; after 0.00561905 ms</div>
</body></html>